<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>OpenSeadragon Image Viewer</title>

  <!-- OpenSeadragon from CDN -->
  <script src="https://cdn.jsdelivr.net/npm/openseadragon@5.0.1/build/openseadragon/openseadragon.min.js"></script>

  <style>
    html,
    body {
      height: 100%;
      margin: 0;
    }

    #osd {
      width: 100%;
      height: 100%;
      background: #111;
    }

    #msg {
      position: fixed;
      left: 0;
      right: 0;
      top: 0;
      padding: 10px 12px;
      font: 14px/1.4 system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      color: #fff;
      background: rgba(0, 0, 0, .7);
      display: none;
    }

    #msg a {
      color: #9bd;
    }
  </style>
</head>

<body>
  <div id="msg"></div>
  <div id="osd"></div>

  <script>
    const msgEl = document.getElementById("msg");

    function showMsg(html) {
      msgEl.innerHTML = html;
      msgEl.style.display = "block";
    }

    const params = new URLSearchParams(location.search);
    const src = params.get("src");

    if (!src) {
      showMsg(`Missing <code>?src=</code>. Example:
        <a href="?src=https%3A%2F%2Fiiif.harvardartmuseums.org%2Fmanifests%2Fobject%2F299843">
          try an example
        </a>`);
      throw new Error("Missing src");
    }

    // Heuristic:
    // - If src ends with "info.json", treat as IIIF image source.
    // - Otherwise treat as a plain image URL.
    const isIIIFInfoJson = /info\.json(\?.*)?$/i.test(src);

    const viewer = OpenSeadragon({
      id: "osd",
      prefixUrl: "https://cdn.jsdelivr.net/npm/openseadragon@5.0.1/build/openseadragon/images/",
      showNavigator: true,
      showRotationControl: true,
      gestureSettingsMouse: { scrollToZoom: true },
      // If you run into cross-origin issues, the underlying server needs CORS headers.
    });

    const tileSource = isIIIFInfoJson
      ? src
      : { type: "image", url: src };

    viewer.open(tileSource);

    // Basic error reporting
    viewer.addHandler("open-failed", (e) => {
      showMsg(`Failed to open <code>src</code>.<br>
        If this is a normal image URL, it may be blocked by CORS.<br>
        <small>${(e && e.message) ? e.message : ""}</small>`);
    });
  </script>
</body>

</html>